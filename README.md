# SolarRHN

ç”¨å¤ªé˜³ä¸­å¾®å­æ¢æµ‹å™¨æœç´¢MeVè´¨é‡èŒƒå›´çš„å³æ‰‹ä¸­å¾®å­ (Right-Handed Neutrino)

> Search for right-handed neutrino in the MeV mass range with solar neutrino detector

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä¸»è¦åŠŸèƒ½](#ä¸»è¦åŠŸèƒ½)
- [å‚æ•°æ‰«æå·¥ä½œæµ](#å‚æ•°æ‰«æå·¥ä½œæµ)
- [ä»CSVæ–‡ä»¶è®¡ç®—ç”µå­è°±](#ä»csvæ–‡ä»¶è®¡ç®—ç”µå­è°±)
- [è¾“å‡ºæ–‡ä»¶è¯´æ˜](#è¾“å‡ºæ–‡ä»¶è¯´æ˜)
- [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
- [æŠ€æœ¯ç»†èŠ‚](#æŠ€æœ¯ç»†èŠ‚)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)

---

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ç”¨äºæ¨¡æ‹Ÿå¤ªé˜³ä¸­äº§ç”Ÿçš„å³æ‰‹ä¸­å¾®å­(RHN)åœ¨é£å‘åœ°çƒé€”ä¸­çš„è¡°å˜ï¼Œä»¥åŠè¡°å˜äº§ç”Ÿçš„å·¦æ‰‹ä¸­å¾®å­ä¸åœ°çƒæ¢æµ‹å™¨ä¸­ç”µå­çš„æ•£å°„è¿‡ç¨‹ã€‚

### ç‰©ç†è¿‡ç¨‹

1. **RHNäº§ç”Ÿ**ï¼šå¤ªé˜³ä¸­çš„â¸Bä¸­å¾®å­é€šè¿‡æ··åˆäº§ç”ŸRHN
2. **RHNè¡°å˜**ï¼šRHNåœ¨å¤ªé˜³-åœ°çƒä¹‹é—´è¡°å˜ä¸ºå·¦æ‰‹ä¸­å¾®å­å’Œç”µå­å¯¹
3. **ä¸­å¾®å­æ•£å°„**ï¼šå·¦æ‰‹ä¸­å¾®å­ä¸æ¢æµ‹å™¨ä¸­çš„ç”µå­å‘ç”Ÿæ•£å°„
4. **ä¿¡å·æ¢æµ‹**ï¼šæ¢æµ‹æ•£å°„äº§ç”Ÿçš„åå†²ç”µå­

### ä¸»è¦å‚æ•°

- **UÂ²**ï¼šRHNä¸æ ‡å‡†æ¨¡å‹ä¸­å¾®å­çš„æ··åˆå‚æ•°å¹³æ–¹ï¼ˆå…¸å‹èŒƒå›´ï¼š10â»â¶ - 10â»Â¹ï¼‰
- **MH**ï¼šRHNè´¨é‡ï¼ˆå•ä½ï¼šMeVï¼Œå…¸å‹èŒƒå›´ï¼š2-12 MeVï¼‰

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```bash
# Python 3.x with required packages:
pip install numpy pandas scipy matplotlib
```

### 1. å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èæ–°ç”¨æˆ·ï¼‰

æµ‹è¯•å•ç»„å‚æ•°ä»¥éªŒè¯ä»£ç æ­£å¸¸å·¥ä½œï¼š

```bash
python run_quick_test.py
```

è¿™å°†è®¡ç®— UÂ²=0.1, MH=4.0 MeV çš„ä¸­å¾®å­å’Œç”µå­åˆ†å¸ƒï¼Œå¹¶ç”Ÿæˆæ‰€æœ‰å›¾è¡¨ã€‚

### 2. å®Œæ•´å‚æ•°æ‰«æ

ç¼–è¾‘ `toymc.py` è®¾ç½®å‚æ•°èŒƒå›´ï¼š

```python
# å®šä¹‰æ‰«æçš„å‚æ•°å€¼
U2_values = [0.1, 0.01, 0.001]
MH_values = [2.0, 4.0, 6.0, 8.0, 10.0]
```

format
ç„¶åè¿è¡Œï¼š

```bash
python toymc.py
```

### 3. ä»å·²æœ‰æ•°æ®è®¡ç®—ç”µå­è°±

å¦‚æœå·²æœ‰ä¸­å¾®å­åˆ†å¸ƒCSVæ–‡ä»¶ï¼Œå¯ç›´æ¥è®¡ç®—æ•£å°„ç”µå­è°±ï¼š

```bash
python compute_electron_from_csv.py ./data/simulation/diff_El_costheta_M4.0_U1.0e-01.csv
```

---

## ä¸»è¦åŠŸèƒ½

### âœ¨ æ ¸å¿ƒè®¡ç®—åŠŸèƒ½

#### 1. RHNè¡°å˜äº§ç”Ÿçš„ä¸­å¾®å­åˆ†å¸ƒ

```python
from utils import get_and_save_nuL_El_costheta_decay_in_flight

diff_El, diff_costheta, diff_cosphi, diff_El_costheta = \
    get_and_save_nuL_El_costheta_decay_in_flight(
        spectrum_nuL_orig,  # å¤ªé˜³ä¸­å¾®å­è°±
        U2=0.01,            # æ··åˆå‚æ•°
        MH=4.0,             # RHNè´¨é‡ (MeV)
        savepath='./data/'
    )
```

**è¾“å‡º**ï¼š

- 1Dèƒ½é‡åˆ†å¸ƒ
- 1Dè§’åº¦åˆ†å¸ƒï¼ˆç›¸å¯¹äºå¤ªé˜³-åœ°çƒæ–¹å‘ï¼‰
- 2Dèƒ½é‡-è§’åº¦åˆ†å¸ƒ
- CSVæ•°æ®æ–‡ä»¶

#### 2. ä¸­å¾®å­-ç”µå­æ•£å°„

```python
from utils import get_and_save_nuL_scatter_electron_El_costheta

electron_2d, e_bins, costheta_bins, _ = \
    get_and_save_nuL_scatter_electron_El_costheta(
        diff_El_costheta_nu,  # ä¸­å¾®å­2Dåˆ†å¸ƒ
        savepath='./data/',
        N_int_local=100000    # è’™ç‰¹å¡ç½—æ ·æœ¬æ•°
    )
```

**ç‰¹ç‚¹**ï¼š

- ä½¿ç”¨**æ”¹è¿›çš„æ–¹ä½è§’é‡‡æ ·**æ–¹æ³•ï¼ˆ12ä¸ªÏ†é‡‡æ ·ç‚¹ï¼‰
- ç²¾ç¡®è€ƒè™‘ `cos(Î¸_lab) = cos(Î¸_in)Â·cos(Î¸_s) - sin(Î¸_in)Â·sin(Î¸_s)Â·cos(Ï†)`
- å¯¹å¤§è§’åº¦å…¥å°„æ˜¾è‘—æå‡ç²¾åº¦

#### 3. ä»CSVæ–‡ä»¶è®¡ç®—

```python
from utils import get_and_save_nuL_scatter_electron_El_costheta_from_csv

electron_2d, e_bins, costheta_bins, _ = \
    get_and_save_nuL_scatter_electron_El_costheta_from_csv(
        csv_path='./data/diff_El_costheta_M4.0_U1.0e-01.csv',
        savepath='./results/',
        N_int_local=100000,
        plot=True
    )
```

---

## å‚æ•°æ‰«æå·¥ä½œæµ

### è‡ªåŠ¨åŒ–æµç¨‹

`toymc.py` è„šæœ¬è‡ªåŠ¨éå† UÂ² Ã— MH å‚æ•°ç©ºé—´ï¼Œå¯¹æ¯ç»„å‚æ•°ï¼š

1. âœ… è®¡ç®—RHNè¡°å˜äº§ç”Ÿçš„ä¸­å¾®å­åˆ†å¸ƒ
2. âœ… ç”Ÿæˆä¸­å¾®å­2Dçƒ­å›¾ + 1Dèƒ½é‡è°± + 1Dè§’åº¦åˆ†å¸ƒ
3. âœ… è®¡ç®—ä¸­å¾®å­-ç”µå­æ•£å°„
4. âœ… ç”Ÿæˆç”µå­2Dçƒ­å›¾ + 1Dèƒ½é‡è°± + 1Dè§’åº¦åˆ†å¸ƒ
5. âœ… ä¿å­˜æ‰€æœ‰æ•°æ®CSVæ–‡ä»¶
6. âœ… ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š

### é…ç½®é€‰é¡¹

#### å‚æ•°ç½‘æ ¼è®¾ç½®

```python
# å¯¹æ•°é—´éš”çš„UÂ²å€¼
U2_values = np.logspace(-5, -1, 20)  # 10â»âµ to 10â»Â¹, 20ä¸ªç‚¹

# å‡åŒ€é—´éš”çš„MHå€¼
MH_values = np.linspace(2.0, 12.0, 50)  # 2åˆ°12 MeV, 50ä¸ªç‚¹

# ç‰¹å®šå€¼
U2_values = [0.1, 0.05, 0.01, 0.005, 0.001]
MH_values = [2.0, 3.0, 4.0, 5.0, 6.0, 8.0, 10.0, 12.0]
```

#### èƒ½é‡ç½‘æ ¼è®¾ç½®

```python
# ç²—ç½‘æ ¼ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
energy = np.arange(0.0, 16.0, step=0.5)

# ä¸­ç­‰ç²¾åº¦ï¼ˆæ¨èï¼‰
energy = np.arange(0.0, 16.0, step=0.2)

# é«˜ç²¾åº¦ï¼ˆè®¡ç®—è¾ƒæ…¢ï¼‰
energy = np.arange(0.0, 16.0, step=0.1)
```

#### è’™ç‰¹å¡ç½—æ ·æœ¬æ•°

```python
# å¿«é€Ÿæµ‹è¯•
N_int_local = 10000

# æ ‡å‡†ç²¾åº¦ï¼ˆæ¨èï¼‰
N_int_local = 100000

# é«˜ç²¾åº¦
N_int_local = 500000
```

#### å¹¶è¡Œå¤„ç†

```python
# é¡ºåºå¤„ç†ï¼ˆé»˜è®¤ï¼Œä¾¿äºè°ƒè¯•ï¼‰
results = []
for args in args_list:
    result = process_single_parameter_set(args)
    results.append(result)

# å¹¶è¡Œå¤„ç†ï¼ˆæ›´å¿«ï¼‰
import multiprocessing as mp
with mp.Pool(processes=4) as pool:  # è°ƒæ•´ä¸ºCPUæ ¸å¿ƒæ•°
    results = pool.map(process_single_parameter_set, args_list)
```

### è¾“å‡ºç»“æ„

```txt
plots_grid_scan/                                   # ä¸»è¾“å‡ºç›®å½•
â”œâ”€â”€ summary.txt                                    # æ‰€æœ‰å‚æ•°æ±‡æ€»
â”‚
â”œâ”€â”€ U2_1.00e-01_MH_2.0/                           # æ¯ç»„å‚æ•°ä¸€ä¸ªå­ç›®å½•
â”‚   â”œâ”€â”€ neutrino_2d_U2_1.00e-01_MH_2.0.pdf       # ä¸­å¾®å­2Dåˆ†å¸ƒ
â”‚   â”œâ”€â”€ neutrino_energy_1d_U2_1.00e-01_MH_2.0.pdf # ä¸­å¾®å­èƒ½é‡è°±
â”‚   â”œâ”€â”€ neutrino_angle_1d_U2_1.00e-01_MH_2.0.pdf  # ä¸­å¾®å­è§’åˆ†å¸ƒ
â”‚   â”œâ”€â”€ electron_2d_U2_1.00e-01_MH_2.0.pdf        # ç”µå­2Dåˆ†å¸ƒ
â”‚   â”œâ”€â”€ electron_energy_1d_U2_1.00e-01_MH_2.0.pdf # ç”µå­èƒ½é‡è°±
â”‚   â”œâ”€â”€ electron_angle_1d_U2_1.00e-01_MH_2.0.pdf  # ç”µå­è§’åˆ†å¸ƒ
â”‚   â”œâ”€â”€ diff_El_M2.0_U1.0e-01.csv                 # èƒ½é‡åˆ†å¸ƒæ•°æ®
â”‚   â”œâ”€â”€ diff_costheta_M2.0_U1.0e-01.csv           # è§’åº¦åˆ†å¸ƒæ•°æ®
â”‚   â”œâ”€â”€ diff_El_costheta_M2.0_U1.0e-01.csv        # 2Dåˆ†å¸ƒæ•°æ®
â”‚   â””â”€â”€ scattered_electrons_2d_lab.csv            # ç”µå­2Dåˆ†å¸ƒæ•°æ®
â”‚
â”œâ”€â”€ U2_1.00e-01_MH_4.0/
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

---

## ä»CSVæ–‡ä»¶è®¡ç®—ç”µå­è°±

### å•æ–‡ä»¶å¤„ç†

```bash
# åŸºæœ¬ç”¨æ³•
python compute_electron_from_csv.py <neutrino_csv_file>

# ç¤ºä¾‹
python compute_electron_from_csv.py ./data/simulation/diff_El_costheta_M4.0_U1.0e-01.csv

# è‡ªå®šä¹‰è¾“å‡ºç›®å½•
python compute_electron_from_csv.py input.csv --output-dir ./results/

# è°ƒæ•´è’™ç‰¹å¡ç½—æ ·æœ¬æ•°
python compute_electron_from_csv.py input.csv --samples 200000

# åªè®¡ç®—ä¸ç»˜å›¾ï¼ˆåŠ å¿«é€Ÿåº¦ï¼‰
python compute_electron_from_csv.py input.csv --no-plot
```

**ä¼˜åŠ¿**ï¼š

- æ— éœ€é‡æ–°è¿è¡ŒRHNè¡°å˜è®¡ç®—ï¼ˆèŠ‚çœæ—¶é—´ï¼‰
- å¯ä»¥ä½¿ç”¨ä¸åŒçš„MCæ ·æœ¬æ•°é‡æ–°è®¡ç®—
- é€‚åˆè°ƒè¯•å’Œå‚æ•°ä¼˜åŒ–

### æ‰¹é‡å¤„ç†

```bash
# å¤„ç†ç›®å½•ä¸­æ‰€æœ‰ä¸­å¾®å­CSVæ–‡ä»¶
python batch_compute_electrons.py [directory]

# ç¤ºä¾‹
python batch_compute_electrons.py ./plots_grid_scan/

# å…ˆåˆ—å‡ºæ–‡ä»¶ä¸å¤„ç†
python batch_compute_electrons.py ./data/ --list-only

# æ‰¹é‡å¤„ç†å¹¶è°ƒæ•´å‚æ•°
python batch_compute_electrons.py ./data/ --samples 50000 --no-plot
```

**è¾“å‡º**ï¼š

- æ¯ä¸ªæ–‡ä»¶å¯¹åº”çš„ç”µå­è°±CSVå’Œå›¾è¡¨
- `electron_batch_summary.csv` æ±‡æ€»è¡¨æ ¼

### Python API

```python
# åˆ—å‡ºæ‰€æœ‰ä¸­å¾®å­CSVæ–‡ä»¶
from utils import list_neutrino_csv_files
files = list_neutrino_csv_files('./data/simulation/')
for f in files:
    print(f"{f['filename']}: MH={f['MH']}, U2={f['U2']}")

# æ‰¹é‡å¤„ç†
from utils import batch_compute_electrons_from_csv
results = batch_compute_electrons_from_csv(
    directory='./data/',
    N_int_local=100000,
    plot=True
)
```

---

## è¾“å‡ºæ–‡ä»¶è¯´æ˜

### å›¾è¡¨ç±»å‹

1. **neutrino_2d** - äºŒç»´çƒ­å›¾
   - Xè½´ï¼šä¸­å¾®å­èƒ½é‡ (MeV)
   - Yè½´ï¼šcos(Î¸)ï¼ŒÎ¸æ˜¯ç›¸å¯¹äºå¤ªé˜³-åœ°çƒæ–¹å‘çš„è§’åº¦
   - é¢œè‰²ï¼šé€šé‡å¯†åº¦ (cmâ»Â² sâ»Â¹ MeVâ»Â¹ srâ»Â¹)

2. **neutrino_energy_1d** - ä¸€ç»´èƒ½é‡è°±
   - Xè½´ï¼šèƒ½é‡ (MeV)
   - Yè½´ï¼šé€šé‡ (MeVâ»Â¹ cmâ»Â² sâ»Â¹)
   - å¯¹2Dåˆ†å¸ƒåœ¨è§’åº¦ä¸Šç§¯åˆ†çš„ç»“æœ

3. **neutrino_angle_1d** - ä¸€ç»´è§’åº¦åˆ†å¸ƒ
   - Xè½´ï¼šcos(Î¸)
   - Yè½´ï¼šé€šé‡ (srâ»Â¹ cmâ»Â² sâ»Â¹)
   - å¯¹2Dåˆ†å¸ƒåœ¨èƒ½é‡ä¸Šç§¯åˆ†çš„ç»“æœ

4. **electron_2d** - äºŒç»´çƒ­å›¾
   - Xè½´ï¼šåå†²ç”µå­èƒ½é‡ (MeV)
   - Yè½´ï¼šcos(Î¸)ï¼Œæ•£å°„è§’åº¦
   - é¢œè‰²ï¼šäº‹ä¾‹ç‡å¯†åº¦

5. **electron_energy_1d** - ä¸€ç»´èƒ½é‡è°±
   - Xè½´ï¼šèƒ½é‡ (MeV)
   - Yè½´ï¼šäº‹ä¾‹ç‡ (MeVâ»Â¹)

6. **electron_angle_1d** - ä¸€ç»´è§’åº¦åˆ†å¸ƒ
   - Xè½´ï¼šcos(Î¸)
   - Yè½´ï¼šäº‹ä¾‹ç‡ (srâ»Â¹)

### CSVæ•°æ®æ ¼å¼

**1Dåˆ†å¸ƒ** (å¦‚ `diff_El_M*.csv`, `diff_costheta_M*.csv`):

```csv
energy,value
0.0,0.0
0.2,1.234e-05
...
```

**2Dåˆ†å¸ƒ** (å¦‚ `diff_El_costheta_M*.csv`):

```csv
energy,costheta,value
0.0,-1.0,0.0
0.0,-0.99,0.0
0.2,-1.0,1.234e-06
...
```

### æ±‡æ€»æ–‡ä»¶

`summary.txt` åŒ…å«ï¼š

- **U2**: æ··åˆå‚æ•°å¹³æ–¹
- **MH**: RHNè´¨é‡ (MeV)
- **Neutrino_Flux**: ä¸­å¾®å­æ€»é€šé‡
- **Neutrino_2D_Integral**: 2Dåˆ†å¸ƒç§¯åˆ†ï¼ˆéªŒè¯å½’ä¸€åŒ–ï¼‰
- **Electron_Success**: ç”µå­æ•£å°„è®¡ç®—æ˜¯å¦æˆåŠŸ
- **Output_Dir**: è¾“å‡ºç›®å½•è·¯å¾„

---

## é«˜çº§ç”¨æ³•

### å·¥ä½œæµç¤ºä¾‹

#### åœºæ™¯1ï¼šé‡æ–°è®¡ç®—æŸä¸ªå‚æ•°ç‚¹çš„ç”µå­è°±ï¼ˆé«˜ç²¾åº¦ï¼‰

```bash
# 1. æ‰¾åˆ°å¯¹åº”çš„ä¸­å¾®å­CSVæ–‡ä»¶
ls ./plots_grid_scan/U2_1.00e-01_MH_4.0/diff_El_costheta_*.csv

# 2. é‡æ–°è®¡ç®—ç”µå­è°±ï¼ˆä½¿ç”¨æ›´å¤šæ ·æœ¬æé«˜ç²¾åº¦ï¼‰
python compute_electron_from_csv.py \
    ./plots_grid_scan/U2_1.00e-01_MH_4.0/diff_El_costheta_M4.0_U1.0e-01.csv \
    --samples 500000 \
    --output-dir ./high_precision/
```

#### åœºæ™¯2ï¼šåˆ†ç¦»è®¡ç®—ä¸­å¾®å­å’Œç”µå­

```bash
# Step 1: åªè®¡ç®—ä¸­å¾®å­ï¼ˆä¿®æ”¹toymc.pyæ³¨é‡Šæ‰Step 5-8ï¼‰
python toymc.py

# Step 2: æ‰¹é‡è®¡ç®—æ‰€æœ‰ç”µå­è°±
python batch_compute_electrons.py ./plots_grid_scan/ --samples 100000

# Step 3: æ£€æŸ¥æ±‡æ€»
cat ./plots_grid_scan/electron_batch_summary.csv
```

#### åœºæ™¯3ï¼šæ¢ç´¢MCæ ·æœ¬æ•°çš„å½±å“

```bash
# ä¸åŒç²¾åº¦å¯¹æ¯”
python compute_electron_from_csv.py input.csv --samples 10000 --output-dir ./test_10k/
python compute_electron_from_csv.py input.csv --samples 100000 --output-dir ./test_100k/
python compute_electron_from_csv.py input.csv --samples 500000 --output-dir ./test_500k/

# æ¯”è¾ƒä¸‰ä¸ªç›®å½•ä¸­çš„å›¾è¡¨
```

### åªè®¡ç®—ä¸­å¾®å­åˆ†å¸ƒï¼ˆè·³è¿‡ç”µå­æ•£å°„ï¼‰

ä¿®æ”¹ `process_single_parameter_set` å‡½æ•°ï¼Œæ³¨é‡Šæ‰ Step 5-8ï¼š

```python
# Step 5-8: ç”µå­æ•£å°„éƒ¨åˆ†
# æ³¨é‡Šæ‰ä»¥ä¸‹ä»£ç ä»¥è·³è¿‡ç”µå­è®¡ç®—
# electron_2d, ... = get_and_save_nuL_scatter_electron_El_costheta(...)
```

### è‡ªå®šä¹‰èƒ½é‡é˜ˆå€¼å’Œæ¢æµ‹å™¨æ•ˆç‡

åœ¨æ•£å°„è®¡ç®—åæ·»åŠ ç­›é€‰ï¼š

```python
# åº”ç”¨èƒ½é‡é˜ˆå€¼
E_threshold = 3.0  # MeV
mask = e_centers > E_threshold
electron_2d_filtered = electron_2d[mask, :]

# åº”ç”¨è§’åº¦æ¥å—åº¦
costheta_min = 0.9  # åªæ¥å—å‰å‘äº‹ä¾‹
mask_angle = costheta_centers > costheta_min
electron_2d_filtered = electron_2d_filtered[:, mask_angle]
```

---

## æŠ€æœ¯ç»†èŠ‚

### ç‰©ç†æ¨¡å‹

#### RHNè¡°å˜å®½åº¦

```python
Î“_total = Î“_Î½â„“â„“ + Î“_Î½Î½Î½
```

å…¶ä¸­ï¼š

- `Î“_Î½â„“â„“`: RHN â†’ Î½ + eâº + eâ» è¡°å˜å®½åº¦
- `Î“_Î½Î½Î½`: RHN â†’ Î½ + Î½ + Î½Ì„ è¡°å˜å®½åº¦
- è¡°å˜å®½åº¦æ­£æ¯”äº UÂ² Ã— M_Hâµ

#### æ´›ä¼¦å…¹å˜æ¢

RHNåœ¨å¤ªé˜³ä¸­äº§ç”Ÿåä»¥æ¥è¿‘å…‰é€Ÿé£å‘åœ°çƒã€‚è¡°å˜äº§ç‰©çš„èƒ½é‡å’Œè§’åº¦åˆ†å¸ƒéœ€è¦ä»RHNé™æ­¢ç³»å˜æ¢åˆ°å®éªŒå®¤ç³»ï¼š

```txt
E_lab = Î³(E_cms + Î²Â·p_cmsÂ·cos(Î¸_cms))
cos(Î¸_lab) = (cos(Î¸_cms) + Î²) / (1 + Î²Â·cos(Î¸_cms))
```

#### æ•£å°„æˆªé¢

ä¸­å¾®å­-ç”µå­æ•£å°„ä½¿ç”¨æ ‡å‡†æ¨¡å‹å¼±ç›¸äº’ä½œç”¨æˆªé¢ï¼Œè€ƒè™‘ï¼š

- è·ç”µæµè´¡çŒ® (CC)
- ä¸­æ€§æµè´¡çŒ® (NC)
- ç›¸å¯¹è®ºè¿åŠ¨å­¦

#### æ”¹è¿›çš„è§’åº¦æ˜ å°„

**å®Œæ•´å…¬å¼**ï¼ˆå«æ–¹ä½è§’ä¾èµ–ï¼‰ï¼š

```txt
cos(Î¸_lab) = cos(Î¸_in)Â·cos(Î¸_scatter) - sin(Î¸_in)Â·sin(Î¸_scatter)Â·cos(Ï†)
```

**å®ç°**ï¼š

- å¯¹æ¯ä¸ªæ•£å°„è§’ï¼Œé‡‡æ ·12ä¸ªæ–¹ä½è§’ Ï† âˆˆ [0, 2Ï€]
- ç²¾ç¡®è€ƒè™‘ sin é¡¹çš„è´¡çŒ®
- å¯¹ sin(Î¸_in) è¾ƒå¤§æ—¶æ˜¾è‘—æ”¹å–„ç²¾åº¦

**ç®€åŒ–è¿‘ä¼¼**ï¼ˆä»…é€‚ç”¨äºå°è§’åº¦ï¼‰ï¼š

```txt
<cos(Î¸_lab)> â‰ˆ cos(Î¸_in)Â·cos(Î¸_scatter)
```

### æ•°å€¼æ–¹æ³•

#### èƒ½é‡ç½‘æ ¼é‡é‡‡æ ·

ä½¿ç”¨ä¿å®ˆçš„bin-averageæ–¹æ³•ï¼Œç¡®ä¿é€šé‡å®ˆæ’ï¼š

```python
def resample_bin_average(x_src, y_src, x_tgt):
    # å¯¹æ¯ä¸ªç›®æ ‡binï¼Œç§¯åˆ†æºåˆ†å¸ƒå¹¶é™¤ä»¥binå®½åº¦
    # ç¡®ä¿ âˆ« y_src dx = âˆ« y_tgt dx
```

#### è’™ç‰¹å¡ç½—æ•£å°„è®¡ç®—

`scatter_electron_spectrum` ä½¿ç”¨é‡è¦æ€§é‡‡æ ·ï¼š

- æ ¹æ®ä¸­å¾®å­é€šé‡å¯¹èƒ½é‡é‡‡æ ·
- æ ¹æ®æ•£å°„æˆªé¢å¯¹æ•£å°„è§’é‡‡æ ·
- N_int_local æ§åˆ¶æ ·æœ¬æ•°ï¼ˆé»˜è®¤100000ï¼‰

#### å½’ä¸€åŒ–

æ‰€æœ‰åˆ†å¸ƒå­˜å‚¨ä¸º**å¯†åº¦** (dN/dE/dÎ©)ï¼š

- ç§¯åˆ†æ—¶è‡ªåŠ¨ä¹˜ä»¥binå®½åº¦
- ç¡®ä¿ `âˆ«âˆ« Ï(E,Î¸) dE dÎ¸ = N_total`

### æ•°å€¼éªŒè¯

æ¯æ¬¡è®¡ç®—åéªŒè¯å®ˆæ’æ€§ï¼š

```txt
1Dèƒ½é‡ç§¯åˆ† â‰ˆ 1Dè§’åº¦ç§¯åˆ† â‰ˆ 2Dç§¯åˆ† â‰ˆ N_total
```

å…¸å‹è¯¯å·® < 0.1%ï¼ˆæ•°å€¼ç²¾åº¦é™åˆ¶ï¼‰

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆç”µå­æ•£å°„è®¡ç®—è¿™ä¹ˆæ…¢ï¼Ÿ

**A**: æ¯ä¸ªå…¥å°„è§’åº¦éƒ½éœ€è¦å•ç‹¬è°ƒç”¨è’™ç‰¹å¡ç½—æ•£å°„è®¡ç®—ï¼Œè¿™æ˜¯ç‰©ç†ä¸Šå¿…éœ€çš„ï¼š

- ä¸åŒè§’åº¦çš„ä¸­å¾®å­èƒ½é‡åˆ†å¸ƒä¸åŒï¼ˆæ´›ä¼¦å…¹boostï¼‰
- æ•£å°„æˆªé¢å¼ºçƒˆä¾èµ–èƒ½é‡
- ä¸èƒ½ç®€å•åœ°"å…ˆç§¯åˆ†å†æ•£å°„"

**ä¼˜åŒ–æ–¹æ³•**ï¼š

- å‡å°‘ `--samples`ï¼ˆå¦‚é™åˆ°50000ï¼‰
- å‡å°‘è§’åº¦binsï¼ˆå¦‚ä»201é™åˆ°51ï¼‰
- ä½¿ç”¨ç²—ä¸€ç‚¹çš„èƒ½é‡ç½‘æ ¼
- ä½¿ç”¨ `--no-plot` è·³è¿‡ç»˜å›¾
- å¯ç”¨å¹¶è¡Œå¤„ç†

### Q: 2Dç§¯åˆ†å’Œ1Dç§¯åˆ†ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥å½’ä¸€åŒ–æ–¹æ³•ã€‚å½“å‰ç‰ˆæœ¬ä½¿ç”¨ï¼š

```python
Ï[i,j] = N_total Ã— dist[i,j] / Î£(dist)
```

ç¡®ä¿ï¼š

- åˆ†å¸ƒå­˜å‚¨ä¸ºå¯†åº¦ï¼ˆä¸é¢„ä¹˜binå®½åº¦ï¼‰
- ç§¯åˆ†å‡½æ•°ä¼šè‡ªåŠ¨æ¨æ–­å¹¶ä¹˜ä»¥binå®½åº¦
- æ‰€æœ‰ç§¯åˆ†åº”åœ¨0.1%è¯¯å·®å†…ä¸€è‡´

### Q: æŸäº›å‚æ•°ç»„åˆç”µå­æ•£å°„å¤±è´¥ï¼Ÿ

**A**: å¸¸è§åŸå› ï¼š

- ä¸­å¾®å­é€šé‡å¤ªä½ï¼ˆå°UÂ²æˆ–å¤§MHï¼‰â†’ ç»Ÿè®¡æ¶¨è½
- æ•°å€¼é—®é¢˜ï¼ˆæç«¯å‚æ•°å€¼ï¼‰â†’ æ£€æŸ¥ç‰©ç†åˆç†æ€§
- å†…å­˜ä¸è¶³ â†’ å‡å°‘æ ·æœ¬æ•°æˆ–ç½‘æ ¼ç‚¹

æ£€æŸ¥ `summary.txt` ä¸­çš„ `Electron_Success` åˆ—ã€‚

### Q: å¦‚ä½•åŠ å¿«å¤§è§„æ¨¡å‚æ•°æ‰«æï¼Ÿ

**A**:

1. **å¯ç”¨å¹¶è¡Œå¤„ç†**ï¼ˆæœ€æœ‰æ•ˆï¼‰ï¼š

   ```python
   with mp.Pool(processes=8) as pool:
       results = pool.map(process_single_parameter_set, args_list)
   ```

2. **é™ä½ç²¾åº¦**ï¼ˆé€‚å½“ï¼‰ï¼š
   - èƒ½é‡æ­¥é•¿ï¼š0.5 MeVï¼ˆä»£æ›¿0.2ï¼‰
   - MCæ ·æœ¬ï¼š50000ï¼ˆä»£æ›¿100000ï¼‰
   - è§’åº¦binsï¼š51ï¼ˆä»£æ›¿201ï¼‰

3. **åˆ†ç¦»è®¡ç®—**ï¼š
   - å…ˆç®—æ‰€æœ‰ä¸­å¾®å­åˆ†å¸ƒï¼ˆå¿«ï¼‰
   - åç”¨æ‰¹å¤„ç†ç®—ç”µå­ï¼ˆå¯åœ¨åå°ï¼‰

### Q: å¦‚ä½•éªŒè¯ç»“æœæ­£ç¡®æ€§ï¼Ÿ

**A**:

1. **ç‰©ç†æ£€æŸ¥**ï¼š
   - å‰å‘å³°åŒ–ï¼ˆä¸­å¾®å­é›†ä¸­åœ¨ cosÎ¸ â‰ˆ 1ï¼‰
   - èƒ½é‡èŒƒå›´åˆç†ï¼ˆä¸è¶…è¿‡ E_â¸B â‰ˆ 15 MeVï¼‰
   - é€šé‡éšUÂ²çº¿æ€§å¢é•¿

2. **æ•°å€¼æ£€æŸ¥**ï¼š
   - æ‰€æœ‰ç§¯åˆ†ä¸€è‡´ï¼ˆè¯¯å·® < 0.1%ï¼‰
   - å¢åŠ MCæ ·æœ¬æ•°ï¼Œç»“æœæ”¶æ•›
   - ä¸å·²å‘è¡¨æ–‡çŒ®å¯¹æ¯”

3. **å•å…ƒæµ‹è¯•**ï¼š

   ```bash
   python run_quick_test.py  # æ£€æŸ¥æ ‡å‡†æ¡ˆä¾‹
   ```

### Q: CSVæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Ÿ

**A**: ç¡®ä¿ï¼š

- 3åˆ—ï¼š`energy,costheta,value`
- é€—å·åˆ†éš”
- æœ‰headerè¡Œï¼ˆæˆ–æ— headeréƒ½å¯ä»¥ï¼‰
- æ•°å€¼æ ¼å¼æ­£ç¡®ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼š`1.234e-05`ï¼‰

ç”± `get_and_save_nuL_El_costheta_decay_in_flight` è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€‚

### Q: ç»˜å›¾ä¹±ç æˆ–ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ï¼Ÿ

**A**: é…ç½®matplotlibå­—ä½“ï¼š

```python
import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']  # macOS
plt.rcParams['axes.unicode_minus'] = False
```

### Q: å†…å­˜ä¸è¶³ï¼Ÿ

**A**:

- å‡å°‘èƒ½é‡ç½‘æ ¼ç‚¹æ•°
- å‡å°‘è§’åº¦bins
- å‡å°‘MCæ ·æœ¬æ•°
- ä½¿ç”¨é¡ºåºå¤„ç†ï¼ˆä¸å¹¶è¡Œï¼‰
- åˆ†æ‰¹å¤„ç†å‚æ•°ç‚¹

---

## æ–‡ä»¶ç»“æ„

### æ ¸å¿ƒä»£ç 

```txt
SolarRHN/
â”œâ”€â”€ core/                             # æ ¸å¿ƒç‰©ç†è®¡ç®—åŒ…
â”‚   â”œâ”€â”€ __init__.py                  # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ constants.py                 # ç‰©ç†å¸¸æ•°
â”‚   â”œâ”€â”€ rhn_physics.py               # RHNè¡°å˜ç‰©ç†
â”‚   â”œâ”€â”€ transformations.py           # æ´›ä¼¦å…¹å˜æ¢
â”‚   â”œâ”€â”€ decay_distributions.py       # è¡°å˜è¿åŠ¨å­¦
â”‚   â”œâ”€â”€ spectrum_utils.py            # èƒ½è°±å·¥å…·
â”‚   â”œâ”€â”€ neutrino_electron_scattering.py  # Î½-eæ•£å°„
â”‚   â”œâ”€â”€ electron_scattering.py       # ç”µå­æ•£å°„è®¡ç®—
â”‚   â”œâ”€â”€ sampling.py                  # è’™ç‰¹å¡ç½—é‡‡æ ·
â”‚   â””â”€â”€ tools.py                     # è¾…åŠ©å·¥å…·ï¼ˆè®¡æ—¶å™¨ç­‰ï¼‰
â”‚
â”œâ”€â”€ workflows.py                      # å®Œæ•´åˆ†ææµç¨‹
â”œâ”€â”€ plot_helpers.py                   # ç»˜å›¾å·¥å…·
â””â”€â”€ toymc.py                          # ä¸»å‚æ•°æ‰«æè„šæœ¬
```

### è„šæœ¬å·¥å…·

```txt
â”œâ”€â”€ run_quick_test.py                 # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”œâ”€â”€ compute_electron_from_csv.py      # å•æ–‡ä»¶CSVå¤„ç†
â”œâ”€â”€ batch_compute_electrons.py        # æ‰¹é‡CSVå¤„ç†
â””â”€â”€ demo_csv_electron.py              # æ¼”ç¤ºè„šæœ¬
```

### æ•°æ®å’Œè¾“å‡º

```txt
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ 8BSpectrum.csv               # â¸Bå¤ªé˜³ä¸­å¾®å­èƒ½è°±
â”‚   â””â”€â”€ simulation/                   # æ¨¡æ‹Ÿç»“æœ
â”‚
â””â”€â”€ plots_grid_scan/                  # å‚æ•°æ‰«æè¾“å‡º
    â”œâ”€â”€ summary.txt
    â””â”€â”€ U2_*_MH_*/
```

### æ–‡æ¡£

```txt
â””â”€â”€ README.md                         # æœ¬æ–‡æ¡£ï¼ˆæ•´åˆç‰ˆï¼‰
```

---

## å¼•ç”¨å’Œå‚è€ƒ

å¦‚æœä½¿ç”¨æœ¬ä»£ç ï¼Œè¯·å¼•ç”¨ç›¸å…³ç‰©ç†æ–‡çŒ®ï¼š

- RHNç‰©ç†æ¨¡å‹ï¼š[ç›¸å…³è®ºæ–‡]
- å¤ªé˜³ä¸­å¾®å­ï¼š[Bahcall et al.]
- ä¸­å¾®å­-ç”µå­æ•£å°„ï¼š[Standard Model]

---

## æ›´æ–°æ—¥å¿—

### æœ€æ–°ç‰ˆæœ¬

- âœ… æ”¹è¿›çš„è§’åº¦æ˜ å°„ï¼ˆæ–¹ä½è§’é‡‡æ ·ï¼‰
- âœ… CSVæ–‡ä»¶ç›´æ¥è®¡ç®—åŠŸèƒ½
- âœ… æ‰¹é‡å¤„ç†å·¥å…·
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å½’ä¸€åŒ–ä¿®å¤ï¼ˆ2D/1Dä¸€è‡´æ€§ï¼‰

### å†å²ç‰ˆæœ¬

- v1.0: åŸºç¡€RHNè¡°å˜å’Œæ•£å°„è®¡ç®—
- v1.1: æ·»åŠ å‚æ•°æ‰«æåŠŸèƒ½
- v1.2: Jacobianä¿®æ­£
- v2.0: å®Œæ•´é‡æ„ï¼Œæ·»åŠ CSVå·¥å…·

---

## è´¡çŒ®è€…

- ä¸»è¦å¼€å‘ï¼šYutao Zhu, Zhicai Zhang

---

## è®¸å¯è¯

MIT

---

## è”ç³»æ–¹å¼

- é—®é¢˜åé¦ˆï¼š[GitHub Issues]
- é‚®ç®±ï¼š[zhu-yt24@mails.tsinghua.edu.cn]

---

**Happy hunting for RHNs! ğŸ”¬âœ¨**
